<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet" />

    <!-- Icon Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />

    <!-- TroyArticles Libraries -->
    <link href="/lib/animate/animate.min.css" rel="stylesheet" />
    <link href="/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />

    <!-- TroyArticles Bootstrap Theme -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" />

    <!-- TroyArticles Main Styles -->
    <link href="/css/style.css" rel="stylesheet" />
</head>

<body class="bg-light">

    <div class="container py-4">
        <h1 class="mb-4 text-center">Admin Panel</h1>

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">

            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab"
                    data-bs-target="#annual-reports">Annual
                    Reports</button>
            </li>

            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#team">Team</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab"
                    data-bs-target="#contact">Contact</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab"
                    data-bs-target="#partners">Partners</button>
            </li>

        </ul>

        <div class="tab-content">

            <div class="tab-pane fade show active" id="annual-reports">
                <!-- Add Annual Report Form -->
                <form action="/admin/annual-reports" method="POST" enctype="multipart/form-data"
                    class="bg-white p-4 rounded shadow-sm mb-4">
                    <h3>Add Annual Report</h3>

                    <input class="form-control mb-2" name="reportTitle" placeholder="Report Title" required />

                    <input type="number" class="form-control mb-2" name="reportYear" placeholder="Year (e.g. 2025)"
                        required />

                    <textarea class="form-control mb-2" name="description" placeholder="Short Description"></textarea>

                    <label class="form-label">Upload Report (PDF or Document)</label>
                    <input type="file" class="form-control mb-3" name="reportFile" accept=".pdf,.doc,.docx" required />

                    <button class="btn btn-primary">ðŸ“¤ Upload Report</button>
                </form>

                <!-- Existing Reports Table -->
                <h3>Existing Annual Reports</h3>
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Year</th>
                            <th>Description</th>
                            <th>Report File</th>
                            <th>Submitted</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% annualReports.forEach(r=> { %>
                            <tr>
                                <td>
                                    <%= r.reportTitle %>
                                </td>
                                <td>
                                    <%= r.reportYear %>
                                </td>
                                <td>
                                    <%= r.description || 'â€”' %>
                                </td>
                                <td>
                                    <% if (r.reportUrl) { %>
                                        <a href="<%= r.reportUrl %>" target="_blank"
                                            class="btn btn-outline-info btn-sm">
                                            <i class="fas fa-file-pdf"></i> View
                                        </a>
                                        <% } else { %>
                                            <span class="text-muted">No File</span>
                                            <% } %>
                                </td>
                                <td>
                                    <%= new Date(r.submittedAt).toLocaleDateString() %>
                                </td>
                                <td>
                                    <!-- Edit -->
                                    <button type="button" class="btn btn-warning btn-sm me-2"
                                        onclick="editReport('<%= r.id %>', '<%= r.reportTitle %>', '<%= r.reportYear %>', '<%- r.description.replace(/'/g, '\\\'').replace(/\n/g, ' ') %>')"
                                        <i class="fas fa-edit"></i> Edit
                                    </button>

                                    <!-- Delete -->
                                    <form action="/admin/annual-reports/delete/<%= r.id %>" method="POST"
                                        class="d-inline"
                                        onsubmit="return confirm('Are you sure you want to delete this report?');">
                                        <button type="submit" class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash-alt"></i> Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>

                <!-- Edit Modal -->
                <div class="modal fade" id="editReportModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <form id="editReportForm" method="POST" enctype="multipart/form-data" class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Edit Annual Report</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" id="editReportId" name="id">

                                <input type="text" class="form-control mb-2" name="reportTitle" id="editReportTitle"
                                    placeholder="Title" required>

                                <input type="number" class="form-control mb-2" name="reportYear" id="editReportYear"
                                    required>

                                <textarea class="form-control mb-2" name="description" id="editReportDescription"
                                    rows="3" placeholder="Description"></textarea>

                                <label class="form-label">Replace Report File (optional)</label>
                                <input type="file" class="form-control mb-2" name="reportFile" accept=".pdf,.doc,.docx">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-success">ðŸ’¾ Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>





            <!-- Team -->
            <div class="tab-pane fade" id="team">
                <form action="/admin/team" method="POST" enctype="multipart/form-data"
                    class="bg-white p-4 rounded shadow-sm mb-4">
                    <h3>Add Team Member</h3>

                    <input class="form-control mb-2" name="fullName" placeholder="Full Name" required />
                    <input class="form-control mb-2" name="role" placeholder="Role" required />

                    <!-- Replace URL input with file upload -->
                    <label class="form-label">Profile Image</label>
                    <input type="file" class="form-control mb-3" name="image" accept="image/*" required />

                    <button class="btn btn-primary">Add Member</button>
                </form>

                <h3>Existing Team</h3>
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Role</th>
                            <th>Image</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% teamMembers.forEach(m=> { %>
                            <tr>
                                <td>
                                    <%= m.fullName %>
                                </td>
                                <td>
                                    <%= m.role %>
                                </td>
                                <td><img src="<%= m.imageUrl %>" style="height:40px; border-radius:4px;" /></td>
                                <td>
                                    <!-- Edit Button -->
                                    <button type="button" class="btn btn-warning btn-sm me-2"
                                        onclick="editMember('<%= m.id %>', '<%= m.fullName %>', '<%= m.role %>')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>

                                    <!-- Delete Form -->
                                    <form action="/team/delete/<%= m.id %>" method="POST" class="d-inline"
                                        onsubmit="return confirm('Are you sure you want to delete this team member?');">
                                        <button type="submit" class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash-alt"></i> Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>

                <!-- Hidden Edit Modal -->
                <div class="modal fade" id="editTeamModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <form id="editTeamForm" method="POST" enctype="multipart/form-data" class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Edit Team Member</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" name="id" id="editId">
                                <input type="text" class="form-control mb-2" name="fullName" id="editName"
                                    placeholder="Full Name" required>
                                <input type="text" class="form-control mb-2" name="role" id="editRole"
                                    placeholder="Role" required>
                                <label class="form-label">Change Image (optional)</label>
                                <input type="file" class="form-control mb-3" name="image" accept="image/*">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-success">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Publications -->

            <!-- Contact -->
            <div class="tab-pane fade" id="contact">
                Here, you can manage contact inquiries.
                <br /><br />

                <h3>Existing Contacts</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% contacts.forEach(c=> { %>
                            <tr>
                                <td>
                                    <%= c.fullName %>
                                </td>
                                <td>
                                    <%= c.phone %>
                                </td>
                                <td>
                                    <%= c.email %>
                                </td>
                                <td>
                                    <%= c.message %>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </div>

            <!-- Partners -->
            <div class="tab-pane fade" id="partners">
                <form action="/admin/partners" method="POST" class="bg-white p-4 rounded shadow-sm mb-4">
                    <h3>Add Partner</h3>
                    <input class="form-control mb-2" name="name" placeholder="Name" required />
                    <input class="form-control mb-2" name="website" placeholder="Website" required />
                    <input class="form-control mb-2" name="logo" placeholder="Logo URL" required />
                    <button class="btn btn-primary">Add Partner</button>
                </form>

                <h3>Existing Partners</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Website</th>
                            <th>Logo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% partners.forEach(p=> { %>
                            <tr>
                                <td>
                                    <%= p.name %>
                                </td>
                                <td>
                                    <%= p.website %>
                                </td>
                                <td><img src="<%= p.logo %>" style="height:40px" /></td>
                                <td>
                                    <form action="/admin/partners/delete/<%= p.id %>" method="POST" class="d-inline"
                                        onsubmit="return confirm('Are you sure you want to delete this partner?');">
                                        <button type="submit" class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash-alt"></i> Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </div>

            <div class="tab-pane fade" id="newsletter">
                <h3>Newsletter Subscribers</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% newsletterSubscribers.forEach(m=> { %>
                            <tr>
                                <td>
                                    <%= m.email %>
                                </td>
                                <td>
                                <td>
                                    <form action="mailto:<%= m.email %>" method="POST" class="d-inline"
                                        onsubmit="return confirm('You are about to send an email to this user. Do you want to continue?');">
                                        <button type="submit" class="btn btn-primary btn-sm">
                                            <i class="fas fa-envelope"></i> Send Email
                                        </button>
                                    </form>
                                </td>
                                <td></td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function editPublication(id, title, description, category, buttonLink, postedDate) {
            // Fill the form fields
            document.getElementById('editPubId').value = id;
            document.getElementById('editPubTitle').value = title;
            document.getElementById('editPubDescription').value = description;
            document.getElementById('editPubCategory').value = category;
            document.getElementById('editPubButtonLink').value = buttonLink || '';
            document.getElementById('editPubPostedDate').value = postedDate;

            // âœ… Set the action dynamically
            const form = document.getElementById('editPublicationForm');
            form.action = `/publications/edit/${id}`;

            // Show modal using Bootstrap 5 API
            const modalElement = document.getElementById('editPublicationModal');
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
        }
        function editMember(id, name, role) {
            // Fill modal fields
            document.getElementById("editId").value = id;
            document.getElementById("editName").value = name;
            document.getElementById("editRole").value = role;

            // Set form action dynamically
            const form = document.getElementById("editTeamForm");
            form.action = `/team/edit/${id}`;

            // Show modal (requires Bootstrap JS)
            const editModal = new bootstrap.Modal(document.getElementById("editTeamModal"));
            editModal.show();
        }
    </script>
    <script>
        function editReport(id, title, year, description) {
            document.getElementById('editReportId').value = id;
            document.getElementById('editReportTitle').value = title;
            document.getElementById('editReportYear').value = year;
            document.getElementById('editReportDescription').value = description;
            document.getElementById('editReportForm').action = `/admin/annual-reports/edit/${id}`;
            new bootstrap.Modal(document.getElementById('editReportModal')).show();
        }
    </script>


</body>

</html>